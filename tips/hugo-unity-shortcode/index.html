<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
    <meta name="generator" content="HTML Tidy for HTML5 for Windows version 5.8.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:site_name" content="047">
    <meta property="og:title" content="HugoでUnity WebGLを表示する">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://zeroshina.jp/tips/hugo-unity-shortcode/">
    <meta property="og:image" content="https://zeroshina.jp/tips/hugo-unity-shortcode/cover-thumb.webp">
    <meta property="og:locale" content="ja_JP">
    <link rel="canonical" href="https://zeroshina.jp/tips/hugo-unity-shortcode/">
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/uploads/site/favicon.png">
    <link rel="stylesheet" href="/lib/icomoon/style.css">
    <link rel="stylesheet" href="/lib/lightbox/lightbox.css">
    <script defer type="text/javascript" src="/lib/lightbox/lightbox.js"></script>
    <title>HugoでUnity WebGLを表示する - 047</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KNSCG1XLPB"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-KNSCG1XLPB');
    </script>
</head>
<body>
    <header class="site-header">
        <div class="header-content">
            <div class="site-title">
                <a href="/">047</a>
            </div>
            <nav class="site-menu">
                <div class="menu-item">
                    <a href="/blog/">Blog</a>
                </div>
                <div class="menu-item">
                    <a href="/review/">Review</a>
                </div>
                <div class="menu-item">
                    <a href="/tips/">Tips</a>
                </div>
                <div class="menu-item">
                    <a href="/artwork/">Artwork</a>
                </div>
            </nav>
        </div>
    </header>
    <main class="site-content">
        <div class="main-content">
            <article class="post single section-tips">
                <header class="post-header">
                    <h1 class="post-title">HugoでUnity WebGLを表示する</h1>
                    <div class="post-meta date">
                        <time class="post-meta-item" datetime="2023-11-15 00:00:00 +0900 JST">2023/11/15</time>
                    </div>
                    <div class="post-meta taxonomies taxonomies-category">
                        <span class="post-meta-title taxonomy">Categories:</span> <span class="post-meta-item term"><a href="/categories/coding/">コーディング</a></span>
                    </div>
                    <div class="post-meta taxonomies taxonomies-tag">
                        <span class="post-meta-title taxonomy">Tags:</span> <span class="post-meta-item term"><a href="/tags/unity/">Unity</a></span> <span class="post-meta-item term"><a href="/tags/hugo/">Hugo</a></span>
                    </div>
                </header>
                <div class="post-content">
                    <p>もう半年以上前の話になりますが、WordpressからHugoにサイトを移行した際、Unityコンテンツを移植する必要がありました。</p>
                    <p>慣れないHugoと解凍エラーで苦労したものの、無事Unityコンテンツの表示に成功、さて記事を書くぞという段階で放置してしまっていたので、今更ながらきちんと記事にして残しておこうと思います。</p>
                    <p>手順としては適切なビルド設定をした上で、Unity公式のWebGLテンプレートを流用してショートコードを作るだけの単純なものとなっております。使用したツールのバージョンは以下の通り。</p>
                    <ul>
                        <li>Hugo: v0.120.4</li>
                        <li>Unity: 2022.3.11f1 (LTS)</li>
                    </ul>
                    <aside>
                        <h2>目次</h2>
                        <nav id="TableOfContents">
                            <ul>
                                <li>
                                    <a href="#%E3%83%93%E3%83%AB%E3%83%89%E8%A8%AD%E5%AE%9A">ビルド設定</a>
                                </li>
                                <li>
                                    <a href="#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E4%BD%9C%E6%88%90">ショートコードの作成</a>
                                </li>
                                <li>
                                    <a href="#%E5%90%8C%E4%B8%80%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%A7%E3%81%AE%E5%AE%9F%E8%A1%8C">同一ディレクトリでの実行</a>
                                </li>
                                <li>
                                    <a href="#%E7%95%B0%E3%81%AA%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%A7%E3%81%AE%E5%AE%9F%E8%A1%8C">異なるディレクトリでの実行</a>
                                </li>
                                <li>
                                    <a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a>
                                </li>
                            </ul>
                        </nav>
                    </aside>
                    <h2 id="ビルド設定">ビルド設定</h2>
                    <p>まずはUnityのプロジェクトを開き、ビルド設定からプラットフォームをWebGLに切り替えます。</p>
                    <p>次に「編集→プロジェクト設定→プレイヤー→解像度と表示」から「WebGLテンプレート」の項目をMinimalに変更。テンプレートを改変して使うため、内容は最低限の方が都合がいいです。</p>
                    <p>次に同ページの「公開設定」から「解凍フォールバック」を有効にします。詳細は公式リファレンスに任せますが、要は「圧縮されたコンテンツの解凍に失敗しても大丈夫なようにしとくよ」という機能です。</p>
                    <blockquote>
                        <p><a href="https://docs.unity3d.com/ja/2023.2/Manual/webgl-deploying.html" target="_blank" rel="noopener">Unity ユーザーマニュアル Deploy WebGL application</a></p>
                    </blockquote>
                    <p>解凍の成否はブラウザやサーバー設定に依存するようで、私の環境では「Unable to parse Build/test.framework.js.gz!」といったエラーが出て解凍できませんでした。これを有効にすることで出力されるloader.jsのサイズが僅かに大きくなりますが、解凍できない環境でもUnityを実行できるようになります。</p>
                    <p>圧縮形式はBrotliかGZipをお好みで選択して大丈夫だと思います。無圧縮はファイルサイズが膨れ上がるのでオススメしません。</p>
                    <p>設定が終わったらプロジェクトをビルドし、次の作業に移ります。</p>
                    <h2 id="ショートコードの作成">ショートコードの作成</h2>
                    <p>出力したファイルの構成は以下のようになっています。</p>
                    <ul>
                        <li>[ビルドの出力先]/
                            <ul>
                                <li>index.html</li>
                                <li>Build/
                                    <ul>
                                        <li>[ビルドの出力先].data.js.[圧縮形式]</li>
                                        <li>[ビルドの出力先].framework.js.[圧縮形式]</li>
                                        <li>[ビルドの出力先].loader.js</li>
                                        <li>[ビルドの出力先].wasm.[圧縮形式]</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <p>ビルドの出力先が一部ファイル名に割り当てられ、圧縮設定に応じて拡張子が追加されます。</p>
                    <p>解凍フォールバックが有効なら「.unityweb」が、そうでない場合はBrotliで「.br」、GZipで「.gz」が拡張子になります。無圧縮の場合は拡張子の追加はありません。</p>
                    <p>これらの内、index.htmlがUnityコンテンツ（Buildフォルダ内）を呼び出すファイルにあたるため、これを一部抜粋してショートコードにします。</p>
                    <p>index.htmlの中身は割愛しますが、必要なのは<code>&lt;canvas&gt;</code>と<code>&lt;script&gt;</code>の部分です。これにパスや解像度などの、プロジェクトに依存する箇所をパラメータで制御できるようにしたものが以下になります。</p>
                    <div class="highlight">
                        <div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
                            <table style="border-spacing:0;padding:0;margin:0;border:0;">
                                <tr>
                                    <td style="vertical-align:top;padding:0;margin:0;border:0;">
                                        <pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span></code></pre>
                                    </td>
                                    <td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
                                        <pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go-html-template" data-lang="go-html-template"><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$path</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">"Build/"</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">.Get</span> <span style="color:#e6db74">"path"</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{</span> <span style="color:#a6e22e">$path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">.</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$build</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">.Get</span> <span style="color:#e6db74">"build"</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$ext</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">".unityweb"</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">.Get</span> <span style="color:#e6db74">"ext"</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{</span> <span style="color:#a6e22e">$ext</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">.</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$width</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">.Get</span> <span style="color:#e6db74">"width"</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$height</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">.Get</span> <span style="color:#e6db74">"height"</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$bgc</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">"#000000"</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">.Get</span> <span style="color:#e6db74">"bgc"</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{</span> <span style="color:#a6e22e">$bgc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">.</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">"unity-canvas"</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$width</span> <span style="color:#75715e">}}</span> <span style="color:#e6db74">height=</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$height</span> <span style="color:#75715e">}}</span> <span style="color:#a6e22e">tabindex</span><span style="color:#f92672">=</span><span style="color:#e6db74">"-1"</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">"width: </span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$width</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">px; height: </span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$height</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">px; background-color: </span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$bgc</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">"</span>&gt;&lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">"</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$path</span> <span style="color:#75715e">}}{{</span> <span style="color:#a6e22e">$build</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">.loader.js"</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">/iPhone|iPad|iPod|Android/i</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">userAgent</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Mobile device style: fill the whole browser client area with the game canvas:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">meta</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">'meta'</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">meta</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">'viewport'</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">meta</span>.<span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes'</span>;
</span></span><span style="display:flex;"><span>        document.<span style="color:#a6e22e">getElementsByTagName</span>(<span style="color:#e6db74">'head'</span>)[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">meta</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">"#unity-canvas"</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">"100%"</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">"100%"</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">position</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">"fixed"</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">textAlign</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">"left"</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">createUnityInstance</span>(document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">"#unity-canvas"</span>), {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">dataUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$path</span> <span style="color:#75715e">}}{{</span> <span style="color:#a6e22e">$build</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">.data</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$ext</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">"</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">frameworkUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$path</span> <span style="color:#75715e">}}{{</span> <span style="color:#a6e22e">$build</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">.framework.js</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$ext</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">"</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">codeUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$path</span> <span style="color:#75715e">}}{{</span> <span style="color:#a6e22e">$build</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">.wasm</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">$ext</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">"</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">streamingAssetsUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"StreamingAssets"</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">companyName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">.Site.Title</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">"</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">productName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">.Get</span> <span style="color:#e6db74">"name"</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">"</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">productVersion</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"</span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">.Get</span> <span style="color:#e6db74">"version"</span> <span style="color:#75715e">}}</span><span style="color:#e6db74">"</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      });
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <p>冒頭でショートコードのパラメータを受け取り、<code>&lt;canvas&gt;</code>と<code>&lt;script&gt;</code>の一部に反映させています。使用できるパラメータは以下の通りです。</p>
                    <ul>
                        <li>build
                            <ul>
                                <li>ビルド時に指定した出力先フォルダです。ファイル名の一部になるため必須です。</li>
                            </ul>
                        </li>
                        <li>path（省略可）
                            <ul>
                                <li>使用するフォルダ名。初期値は「Build/」です。</li>
                                <li>ルート相対パスでの呼び出しや、Buildフォルダの名前を変更している場合に指定が必要です。</li>
                            </ul>
                        </li>
                        <li>ext（省略可）
                            <ul>
                                <li>圧縮形式の拡張子。解凍フォールバックを使う前提で.unitywebを初期値にしています。</li>
                                <li>このコードでは無圧縮を指定することが出来ませんが、そもそも使わない想定なので妥協しました。</li>
                            </ul>
                        </li>
                        <li>name
                            <ul>
                                <li>プロジェクトの名前。</li>
                            </ul>
                        </li>
                        <li>version
                            <ul>
                                <li>プロジェクトのバージョン。</li>
                            </ul>
                        </li>
                        <li>width, height
                            <ul>
                                <li>コンテンツの横幅と縦幅。canvasとcssの両方で使われます。</li>
                            </ul>
                        </li>
                        <li>bcg（省略可）
                            <ul>
                                <li>背景色。コンテンツが読み込まれるまでこの色が表示されます。</li>
                                <li>初期値は無難に黒を指定しています。</li>
                            </ul>
                        </li>
                    </ul>
                    <p>上記のコードをHugoサイト内の「layouts/shortcodes/」に配置します。ファイル名がそのままショートコードになりますので、他と競合しない範囲でご自由にどうぞ。ここではシンプルに「unity.html」とした体で進めます。</p>
                    <h2 id="同一ディレクトリでの実行">同一ディレクトリでの実行</h2>
                    <p>次に、実行したいコンテンツ（Buildフォルダ）をHugoサイトの任意のディレクトリに配置します。（index.htmlは不要です）</p>
                    <p>この時、ショートコードを実行するindex.mdとBuildフォルダが異なるディレクトリにある場合は次項を参照してください。</p>
                    <p>あとはindex.mdの任意の箇所に、作成したショートコードを記述することでUnityコンテンツを呼び出すことが出来ます。</p>
                    <p><code>{{&lt; unity build="ビルド時の出力先フォルダ名" width="" height="" name="プロジェクト名" version="" &gt;}}</code></p>
                    <p>各パラメータを記述し、必要に応じて<code>ext=".gz"</code>や<code>bgc="#ffffff"</code>といった設定を追加してください。</p>
                    <h2 id="異なるディレクトリでの実行">異なるディレクトリでの実行</h2>
                    <p>もしindex.mdとBuildフォルダが異なるディレクトリに存在する場合は、ショートコードの「path」パラメータにBuildフォルダのディレクトリを指定する必要があります。</p>
                    <p>例えば、Buildフォルダを「/static/test/」に配置している場合は以下のように記述します。</p>
                    <p><code>{{&lt; unity path="/test/Build/" build="" width="" height="" name="" version="" &gt;}}</code></p>
                    <p>ルート相対パスで指定することによりindex.mdの場所に依存せず実行できます。他にも「同一フォルダにindex.mdとBuildフォルダがあるが、そのindex.mdの中身を他のページからも表示している」といった場合でもpathの指定が必要になるかと思います。</p>
                    <h2 id="まとめ">まとめ</h2>
                    <p>以上、HugoでUnity WebGLを実行するための手順でした。重要なのは以下の2点です。</p>
                    <ul>
                        <li>Unityコンテンツの解凍に失敗する場合、「解凍フォールバック」を有効にする</li>
                        <li>ビルド時の出力名、Buildフォルダのパス、拡張子の指定を適切に行う</li>
                    </ul>
                    <p>これらに見落としがあると実行時にエラーが出るため、動作しない場合は上記を確認してみると改善するかもしれません。</p>
                    <p>余談ですが、私が移行しようと思っていたプロジェクトの一つは、最新バージョンで開くとモデルの座標軸が変わったのかモーションが大変恐ろしいことになっていました。さてどうしたものか…</p>
                </div>
                <footer class="post-footer"></footer>
                <nav class="post-navigation">
                    <div class="next-post">
                        <a href="/tips/svg-regex/">Next: svgファイルを正規表現で置換して最適化する</a>
                    </div>
                    <div class="prev-post">
                        <a href="/tips/blender-alpha-movie/">Prev: Blender 背景を透過したavi動画の出力</a>
                    </div>
                </nav>
            </article>
        </div>
        <div class="side-content">
            <aside class="widget profile">
                <div class="widget-header">
                    <h2>Profile</h2>
                </div>
                <div class="widget-content">
                    <p><img src="/uploads/site/profile.webp" alt="" loading="lazy" width="140" height="140"></p>
                    <p>Author: 047</p>
                    <p>最近は積みゲーを崩しています。</p>
                    <div class="profile-icons">
                        <a href="https://arstla.net/" class="icon icon-home" target="_blank" rel="noopener" title="Site"></a> <a href="https://misskey.io/@zeroshina" class="icon icon-bubble" target="_blank" rel="noopener" title="Misskey"></a> <a href="https://www.buymeacoffee.com/zeroshina" class="icon icon-mug" target="_blank" rel="noopener" title="Buy Me a Coffee"></a> <a href="https://zeroshina.jp/index.xml" class="icon icon-rss" target="_blank" rel="noopener" title="RSS"></a>
                    </div>
                </div>
            </aside>
            <aside class="widget pickup">
                <div class="widget-header">
                    <h2>Information</h2>
                </div>
                <div class="widget-content">
                    <ul>
                        <li>
                            <p><a href="/blog/2024-01-20-sfic/"><img src="/uploads/blog/2024-01-20-sfic-01-thumb.webp" alt="" loading="lazy" width="800" height="533"></a></p>
                            <p><a href="/blog/2024-01-20-sfic/">シンプルな単色アイコンのアセット販売を始めました</a></p>
                        </li>
                    </ul>
                </div>
            </aside>
            <aside class="widget custom">
                <div class="widget-header">
                    <h2>Ad</h2>
                </div>
                <div class="widget-content">
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5700117217719363" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5700117217719363" data-ad-slot="2963772559" data-ad-format="auto" data-full-width-responsive="true"></ins> 
                    <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </aside>
            <aside class="widget taxnomies categories">
                <div class="widget-header">
                    <h2>Categories</h2>
                </div>
                <div class="widget-content">
                    <ul>
                        <li>
                            <a href="/categories/game/">ゲーム (30)</a>
                        </li>
                        <li>
                            <a href="/categories/card/">カード (8)</a>
                        </li>
                        <li>
                            <a href="/categories/coding/">コーディング (4)</a>
                        </li>
                        <li>
                            <a href="/categories/modeling/">モデリング (4)</a>
                        </li>
                        <li>
                            <a href="/categories/diary/">日記 (1)</a>
                        </li>
                        <li>
                            <a href="/categories/information/">お知らせ (1)</a>
                        </li>
                        <li>
                            <a href="/categories/uncategorized/">その他 (1)</a>
                        </li>
                    </ul>
                </div>
            </aside>
            <aside class="widget taxnomies tags">
                <div class="widget-header">
                    <h2>Tags</h2>
                </div>
                <div class="widget-content">
                    <ul>
                        <li>
                            <a href="/tags/steam/">Steam (9)</a>
                        </li>
                        <li>
                            <a href="/tags/dnf/">アラド戦記 (8)</a>
                        </li>
                        <li>
                            <a href="/tags/mobile-app/">アプリ (7)</a>
                        </li>
                        <li>
                            <a href="/tags/nintendo-switch/">Nintendo Switch (7)</a>
                        </li>
                        <li>
                            <a href="/tags/yugioh/">遊戯王 (7)</a>
                        </li>
                        <li>
                            <a href="/tags/blender/">Blender (3)</a>
                        </li>
                        <li>
                            <a href="/tags/vr/">VR (2)</a>
                        </li>
                        <li>
                            <a href="/tags/hugo/">Hugo (1)</a>
                        </li>
                        <li>
                            <a href="/tags/lowpoly/">ローポリ (1)</a>
                        </li>
                        <li>
                            <a href="/tags/powershell/">PowerShell (1)</a>
                        </li>
                        <li>
                            <a href="/tags/sd/">SD (1)</a>
                        </li>
                        <li>
                            <a href="/tags/unity/">Unity (1)</a>
                        </li>
                        <li>
                            <a href="/tags/unreal-engine/">Unreal Engine (1)</a>
                        </li>
                    </ul>
                </div>
            </aside>
            <aside class="widget recent">
                <div class="widget-header">
                    <h2>Recent Blog</h2>
                </div>
                <div class="widget-content">
                    <ul>
                        <li>
                            <p><a href="/blog/2024-07-20-chill-pulse/"><img src="/uploads/blog/2024-07-20-chill-pulse-01-thumb.webp" alt="" loading="lazy" width="800" height="450"></a></p>
                            <p><a href="/blog/2024-07-20-chill-pulse/">作業のお供に ChillPulse</a></p>
                        </li>
                    </ul>
                </div>
                <div class="widget-header">
                    <h2>Recent Review</h2>
                </div>
                <div class="widget-content">
                    <ul>
                        <li>
                            <p><a href="/review/small-sleeve-over/"><img src="/review/small-sleeve-over/cover-thumb.webp" alt="" loading="lazy" width="800" height="450"></a></p>
                            <p><a href="/review/small-sleeve-over/">遊戯王向け オーバースリーブの紹介と比較</a></p>
                        </li>
                    </ul>
                </div>
                <div class="widget-header">
                    <h2>Recent Artwork</h2>
                </div>
                <div class="widget-content">
                    <ul>
                        <li>
                            <p><a href="/artwork/lowpoly-256fes-2023/"><img src="/artwork/lowpoly-256fes-2023/cover-thumb.webp" alt="" loading="lazy" width="800" height="450"></a></p>
                            <p><a href="/artwork/lowpoly-256fes-2023/">ローポリ アルシェインさん in #256fes</a></p>
                        </li>
                    </ul>
                </div>
            </aside>
            <aside class="widget custom">
                <div class="widget-header">
                    <h2>Links</h2>
                </div>
                <div class="widget-content">
                    <ul>
                        <li>
                            <a href="/privacy/">プライバシーポリシー</a>
                        </li>
                        <li>
                            <a href="/categories/">カテゴリ一覧</a>
                        </li>
                        <li>
                            <a href="/tags/">タグ一覧</a>
                        </li>
                    </ul>
                </div>
            </aside>
        </div>
    </main>
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-row">
                <span class="footer-item copyright">© 047</span>
            </div>
        </div>
    </footer>
</body>
</html>
